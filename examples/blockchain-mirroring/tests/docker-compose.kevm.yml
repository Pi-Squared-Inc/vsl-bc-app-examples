networks:
  vsl-network:
    external: true
    name: vsl-network

services:
  backend:
    build:
      context: ../backend
      additional_contexts:
        - root=../../../
      dockerfile: Dockerfile
    environment:
      - PORT=3001
    networks:
      - vsl-network

  mock-rpc:
    build:
      context: ./mock-rpc
      additional_contexts:
        - root=../../../
      dockerfile: Dockerfile
    depends_on:
      - backend
    networks:
      - vsl-network

  mirroring-reth-kevm-claim-submitter:
    build:
      context: ../mirroring-reth-kevm/claim-submitter
      dockerfile: Dockerfile
      additional_contexts:
        root: ../../../
      args:
        - GITHUB_ACTOR=${GITHUB_ACTOR}
        - GITHUB_TOKEN=${GITHUB_TOKEN}
    env_file:
      - ../mirroring-reth-kevm/claim-submitter/integration_test.env
    depends_on:
      - backend
      - mock-rpc
      - mirroring-reth-kevm-claim-verifier
    networks:
      - vsl-network

  mirroring-reth-kevm-claim-verifier:
    build:
      context: ../mirroring-reth-kevm/claim-verifier
      dockerfile: Dockerfile
      additional_contexts:
        root: ../../../
      args:
        - GITHUB_ACTOR=${GITHUB_ACTOR}
        - GITHUB_TOKEN=${GITHUB_TOKEN}
    env_file:
      - ../mirroring-reth-kevm/claim-verifier/integration_test.env
    depends_on:
      - backend
      - mock-rpc
    networks:
      - vsl-network

  tester:
    build:
      context: .
      dockerfile: Dockerfile.kevm
    depends_on:
      - backend
      - mock-rpc
      - mirroring-reth-kevm-claim-verifier
      - mirroring-reth-kevm-claim-submitter
    networks:
      - vsl-network
